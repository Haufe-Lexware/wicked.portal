extends layout

block links 
  link(href='#{glob.network.schema}://#{glob.network.portalHost}/content/swagger-override.css' media='screen' rel='stylesheet' type='text/css')
  link(href='swagger-ui.css' media='screen' rel='stylesheet' type='text/css')
block scripts
  script(src='/assets/jquery/jquery.min.js')
  script(src='/assets/bootstrap/js/bootstrap.min.js')
  script(src='#{glob.network.schema}://#{glob.network.portalHost}/assets/jquery/jquery.min.js')
  script(src='swagger-ui-bundle.js' type='text/javascript')
  script(src='swagger-ui-standalone-preset.js' type='text/javascript')

block bodyScripts
  script(type="text/javascript").
    $(function () {
      var url = window.location.search.match(/url=([^&]+)/);
      if (url && url.length > 1) {
        url = decodeURIComponent(url[1]);
      } else {
        url = "http://petstore.swagger.io/v2/swagger.json";
      }
      var apikey = window.location.search.match(/apikey=([a-zA-Z0-9]+)\&/);
      if (apikey && apikey.length > 1)
        apikey = decodeURIComponent(apikey[1]);
      else
        apikey = null;
      var client_id = window.location.search.match(/client_id=([a-zA-Z0-9]+)\&/);
      if (client_id && client_id.length > 1)
        client_id = decodeURIComponent(client_id[1]);
      else
        client_id = null;
      var client_secret = window.location.search.match(/client_secret=([a-zA-Z0-9]+)\&/);
      if (client_secret && client_secret.length > 1)
        client_secret = decodeURIComponent(client_secret[1]);
      else
        client_secret = null;

      var application = window.location.search.match(/application=([^&]+)/);
      if (application && application.length > 1)
        application = decodeURIComponent(application[1]);
      else
        application = null;
      var redirect_uri = window.location.search.match(/redirect_uri=([^&]+)/);
      if (redirect_uri && redirect_uri.length > 1)
        redirect_uri = decodeURIComponent(redirect_uri[1]);
      else
        redirect_uri = null;

      var supportedMethods = [];
      if (apikey || client_id)
        supportedMethods = ['get', 'post', 'put', 'delete', 'patch'];

      // Pre load translate...
      if(window.SwaggerTranslator) {
        window.SwaggerTranslator.translate();
      }
      const ui = SwaggerUIBundle({
        url: url,
        supportedSubmitMethods: supportedMethods,
        dom_id: '#swagger-ui-container',
        oauth2RedirectUrl: redirect_uri,
        presets: [
          SwaggerUIBundle.presets.apis,
          SwaggerUIBundle.SwaggerUIStandalonePreset
        ],
        onComplete: function(swaggerApi, swaggerUi){
          if(typeof ui.initOAuth == "function") {
            ui.initOAuth({
              clientId: client_id,
              clientSecret: client_secret,
              realm: "your-realms",
              appName: application,
              scopeSeparator: ",",
              additionalQueryStringParams: {}
            });
          }
          if (apikey)
            ui.preauthorizeApiKey("key", apikey);
          if ("http" == "#{glob.network.schema}")
            $('input[name=x-forwarded-proto]').val('https');
        },
        onFailure: function(data) {
          log("Unable to Load SwaggerUI");
        },
        jsonEditor: false,
        apisSorter: "alpha",
        defaultModelRendering: 'schema',
        showRequestHeaders: false
      });
      window.swaggerUi = ui;
      function log() {
        if ('console' in window) {
          console.log.apply(console, arguments);
        }
      }
    });


block content
  .container.wicked-container 
    div(id="message-bar" class="swagger-ui-wrap" data-sw-translate) &nbsp;
    div(id="swagger-ui-container" class="swagger-ui-wrap")