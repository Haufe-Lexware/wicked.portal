extends layout

mixin checkBox(source, value)
  - var inputId = source
  - var inputValue = value
  - var label = source
  .form-check.form-group
    if inputValue
      input(name='#{inputId}' id='#{inputId}' class='form-check-input tag' checked='checked' type='checkbox')
    else
      input(name='#{inputId}' id='#{inputId}' class='form-check-input tag' type='checkbox')
    label
      | !{label}

mixin apiCategories(apiTags, params)
    .card
      .card-body.wicked-api-body
        form(role='form' action='/apis' method='GET')
            b API Categories
            input(name='filter' id='filter' value='on' type='hidden')
            each tag, i in apiTags
              +checkBox(tag, params[tag])
            button(type='submit' onclick='checkCategoryFilter()').btn.btn-primary Filter
            &nbsp;
            a(class="btn btn-primary" href="/apis" role="button") Clear

mixin apiDef(anApi)
    .col-md-4
      .card.h-100
        .card-body.wicked-api-body
          if glob.views.apis.showApiIcon
            img(src='/images/api-icon.png')
          if anApi.auth == 'oauth2'
            a(href='/help/apis' target='_blank')
              img(src='/images/oauth2-icon-32.png' align='right' title='Secured with OAuth2 Access')
          else if anApi.auth == 'none'
          else
            a(href='/help/apis' target='_blank')
              img(src='/images/key-icon-32.png' align='right' title='Secured with API Key Access')

          div.d-flex.flex-column
            a(href='/apis/#{anApi.id}' class='card-title mt-3 mb-0 d-block align-self-start')
              h4= anApi.name
            if anApi.deprecated
              p(style='color:red;') <b>Deprecated</b>
            p!= anApi.desc
            div.mt-auto.align-self-start
              a(class="btn btn-light border" href="/apis/#{anApi.id}" role="button") Information &raquo;

          if anApi.bundle
            p
              a(href='/help/bundles')
                span.badge.badge-info= anApi.bundle

block scripts
  script(type='text/javascript').
    function checkCategoryFilter() {
      if($(".tag:checked").length <= 0){
        $("input[id='filter']").remove();
      }
    }

block content
    .jumbotron.wicked-api-title.mt-5
      .container.wicked-title-container
        h1= title

        p= glob.views.apis.titleTagline

    .container.wicked-container
      if desc
        p!= desc
      p &nbsp;
      div(class="row")
        - var length = apilist.length
        - var apiClass = "col-md-12"
        if (apiTags.length > 0)
          div(class="col-md-3")
            +apiCategories(apiTags, params)
          - apiClass = "col-md-9"
        div(class=apiClass)
            each api, i in apilist
                if (i % 3 == 0)
                  div(class="row mb-3")
                    +apiDef(apilist[i])
                    if (i+1) < length
                      +apiDef(apilist[i+1])
                    if (i+2) < length
                      +apiDef(apilist[i+2])
